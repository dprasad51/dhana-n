<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üè∏ Player Attendance</title>
<style>
  :root{
    --bg:#0c0f13; --panel:#131826; --panel-2:#0f1422; --muted:#9aa4b2; --text:#f2f5f9;
    --accent:#49a8ff; --present:#22c55e; --absent:#ef4444; --late:#f59e0b; --border:#1f2738;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}

  /* Header */
  header{
    position:sticky; top:0; z-index:10; padding:12px 14px; border-bottom:1px solid #1a2233;
    display:flex; flex-wrap:wrap; align-items:center; gap:10px; justify-content:space-between;
    background:
      radial-gradient(1200px 320px at 15% -10%, rgba(73,168,255,.22), transparent),
      radial-gradient(1000px 320px at 85% 110%, rgba(123,220,255,.18), transparent),
      linear-gradient(90deg,#0d1220,#121a2e 35%,#0f1f24 65%,#111625);
    box-shadow:0 2px 0 rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.02);
  }
  h1{margin:0; font-size:18px; color:var(--accent); letter-spacing:.2px}
  .controls{display:flex; flex-wrap:wrap; gap:8px; align-items:center}
  input, textarea, select, button{
    padding:6px 10px; border-radius:10px; border:1px solid var(--border);
    background:#0e1320; color:var(--text); font-size:14px;
  }
  textarea{width:220px; height:64px}
  button{background:#132037; cursor:pointer}
  button.primary{background:linear-gradient(180deg,#2a82ff,#1b73f8); border-color:#1b73f8}
  button.good{background:var(--present); color:#fff}
  button.bad{background:var(--absent); color:#fff}
  button.warn{background:var(--late); color:#111}
  button.ghost{background:#0e1320}
  button:disabled{opacity:.6; cursor:not-allowed}

  main{display:grid; grid-template-columns: 1fr 420px; gap:14px; padding:14px}
  section, aside{
    border:1px solid #1a2233; border-radius:14px; background:var(--panel); padding:12px;
    box-shadow:0 6px 18px rgba(0,0,0,.28), 0 0 0 1px rgba(255,255,255,.03) inset;
  }
  h2{margin:6px 6px 10px; font-size:16px}

  /* Today list */
  .toolbar{display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin:6px 0 12px}
  .pill{padding:4px 8px; border:1px solid var(--border); border-radius:999px; background:#0e1422; color:var(--muted)}
  .today-row{display:grid; grid-template-columns: 1fr auto auto auto auto; gap:8px; align-items:center; padding:6px 8px; border:1px solid var(--border); border-radius:10px; background:#0e1320}
  .today-row + .today-row{margin-top:6px}
  .status-dot{width:10px; height:10px; border-radius:50%}
  .dot-P{background:var(--present)} .dot-A{background:var(--absent)} .dot-L{background:var(--late)}
  .status-badge{font-size:12px; color:#cbd5e1}
  .status-badge.P{color:var(--present)} .status-badge.A{color:var(--absent)} .status-badge.L{color:var(--late)}

  /* Monthly Report */
  .table-wrap{border:1px solid var(--border); border-radius:12px; overflow:auto; background:var(--panel-2)}
  table{width:max(820px,100%); border-collapse:separate; border-spacing:0}
  thead th{
    position:sticky; top:0; background:#0e1422; color:var(--muted);
    border-bottom:1px solid var(--border); font-weight:600; font-size:12px; padding:8px 6px; white-space:nowrap;
  }
  tbody td, tbody th{
    border-bottom:1px solid var(--border); padding:8px 6px; text-align:center; font-size:12px;
  }
  tbody th{position:sticky; left:0; background:#0e1320; text-align:left; z-index:1}
  td.badge{font-weight:700}
  .bP{color:var(--present)} .bA{color:var(--absent)} .bL{color:var(--late)}
  tfoot td{position:sticky; bottom:0; background:#0e1422; color:var(--muted); font-weight:600}

  /* Side panel */
  .card{border:1px solid var(--border); border-radius:12px; background:#0f1422; padding:10px; margin-bottom:10px}
  .grid{display:grid; grid-template-columns:1fr 1fr; gap:8px}
  .stat{background:#0e1320; border:1px solid var(--border); border-radius:10px; padding:10px}
  .stat h3{margin:0 0 4px; font-size:13px; color:var(--muted)}
  .stat p{margin:0; font-size:18px; font-weight:700}

  @media (max-width: 1000px) {
    main{grid-template-columns:1fr}
  }

  /* Print */
  @media print {
    header, .toolbar, .controls, .no-print { display:none !important; }
    body{ background:#fff; color:#000 }
  }
</style>
</head>
<body>
<header>
  <h1>üè∏ Attendance Manager</h1>
  <div class="controls">
    <input id="playerName" placeholder="Add player‚Ä¶"/>
    <button id="addBtn" class="primary">Add</button>
    <textarea id="bulk" placeholder="Bulk add: one name per line or comma separated"></textarea>
    <button id="bulkBtn">Add Bulk</button>
    <button id="exportBtn" class="ghost">Export</button>
    <button id="importBtn" class="ghost">Import</button>
    <input type="file" id="importFile" hidden accept="application/json"/>
    <button id="clearBtn" class="ghost">Clear All</button>
  </div>
</header>

<main>
  <!-- Today -->
  <section>
    <h2>Today's Attendance</h2>
    <div class="toolbar">
      <span class="pill" id="todayLabel">Date: ‚Äî</span>
      <input type="date" id="datePick"/>
      <button id="markAllP" class="good">Mark All Present</button>
      <button id="markAllA" class="bad">Mark All Absent</button>
      <button id="printBtn" class="ghost no-print">Print</button>
    </div>
    <div id="todayList"></div>
  </section>

  <!-- Side / Summary -->
  <aside>
    <div class="card">
      <h2>Summary</h2>
      <div class="grid">
        <div class="stat"><h3>Total Players</h3><p id="sumPlayers">0</p></div>
        <div class="stat"><h3>Days Tracked</h3><p id="sumDays">0</p></div>
        <div class="stat"><h3 class="bP">Present (month)</h3><p id="sumP">0</p></div>
        <div class="stat"><h3 class="bA">Absent (month)</h3><p id="sumA">0</p></div>
        <div class="stat"><h3 class="bL">Late (month)</h3><p id="sumL">0</p></div>
        <div class="stat"><h3>Avg % (month)</h3><p id="sumPct">0%</p></div>
      </div>
    </div>

    <div class="card">
      <h2>Monthly Report</h2>
      <div class="toolbar">
        <input type="month" id="monthPick"/>
        <button id="refreshBtn">Refresh</button>
      </div>
      <div class="table-wrap">
        <table id="monthTable">
          <thead id="monthHead"></thead>
          <tbody id="monthBody"></tbody>
          <tfoot id="monthFoot"></tfoot>
        </table>
      </div>
    </div>
  </aside>
</main>

<script>
(function(){
  // ---------- State ----------
  const KEY='attendance_v1';
  let S = load() || { players:[], records:{} }; // records: {"YYYY-MM-DD": { "Name":"P|A|L", ...}}
  const q=id=>document.getElementById(id);

  // ---------- UI refs ----------
  const playerName=q('playerName'), addBtn=q('addBtn'), bulk=q('bulk'), bulkBtn=q('bulkBtn');
  const exportBtn=q('exportBtn'), importBtn=q('importBtn'), importFile=q('importFile'), clearBtn=q('clearBtn');
  const todayList=q('todayList'), todayLabel=q('todayLabel'), datePick=q('datePick');
  const markAllP=q('markAllP'), markAllA=q('markAllA'), printBtn=q('printBtn');
  const monthPick=q('monthPick'), refreshBtn=q('refreshBtn'), monthHead=q('monthHead'), monthBody=q('monthBody'), monthFoot=q('monthFoot');
  const sumPlayers=q('sumPlayers'), sumDays=q('sumDays'), sumP=q('sumP'), sumA=q('sumA'), sumL=q('sumL'), sumPct=q('sumPct');

  // ---------- Utils ----------
  function today(){ return (new Date()).toISOString().slice(0,10); }
  function ymd(d){ return new Date(d).toISOString().slice(0,10); }
  function save(){ localStorage.setItem(KEY, JSON.stringify(S)); }
  function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||''); }catch{ return null; } }
  function ensureDay(d){ if(!S.records[d]) S.records[d] = {}; }
  function fmtMonthYYYYMM(d){ return d.slice(0,7); }
  function daysInMonth(yyyy,mm){ return new Date(yyyy, mm, 0).getDate(); } // mm: 1..12

  // ---------- Players ----------
  function addPlayer(name){
    if(!name) return;
    if(S.players.includes(name)){ alert('Player already exists'); return; }
    S.players.push(name);
    S.players.sort((a,b)=>a.localeCompare(b));
    save(); renderToday(); renderMonth(); updateSummary();
  }
  function addBulk(text){
    const names = text.split(/[\n,]+/).map(s=>s.trim()).filter(Boolean);
    names.forEach(n=>{ if(!S.players.includes(n)) S.players.push(n); });
    S.players.sort((a,b)=>a.localeCompare(b));
    save(); renderToday(); renderMonth(); updateSummary();
  }
  function delPlayer(name){
    if(!confirm(`Delete ${name}?`)) return;
    S.players = S.players.filter(n=>n!==name);
    // also remove from all days
    Object.keys(S.records).forEach(d=>{ if(S.records[d] && S.records[d][name]) delete S.records[d][name]; });
    save(); renderToday(); renderMonth(); updateSummary();
  }

  // ---------- Attendance Marking ----------
  function mark(name, status, date){
    const d = ymd(date);
    ensureDay(d);
    S.records[d][name] = status; // 'P'| 'A' | 'L'
    save(); renderTodayRow(name); renderMonth(); updateSummary();
  }

  // ---------- Render: Today ----------
  function renderToday(){
    const d = ymd(datePick.value || today());
    datePick.value = d; todayLabel.textContent = `Date: ${d}`;
    todayList.innerHTML = '';
    S.players.forEach(name=> todayList.appendChild(buildTodayRow(name, d)));
  }
  function buildTodayRow(name, d){
    const row=document.createElement('div'); row.className='today-row'; row.id='row-'+cssId(name);
    const st = S.records[d]?.[name] || '';
    row.innerHTML = `
      <div style="display:flex;align-items:center;gap:8px;">
        <span class="status-dot ${st?('dot-'+st):''}"></span>
        <strong>${escapeHtml(name)}</strong>
        <span class="status-badge ${st}">${st ? labelFor(st) : '‚Äî'}</span>
      </div>
      <button class="good">Present</button>
      <button class="bad">Absent</button>
      <button class="warn">Late</button>
      <button class="ghost">Delete</button>
    `;
    const [presentBtn, absentBtn, lateBtn, delBtn] = row.querySelectorAll('button');
    presentBtn.onclick=()=>mark(name,'P',d);
    absentBtn.onclick =()=>mark(name,'A',d);
    lateBtn.onclick   =()=>mark(name,'L',d);
    delBtn.onclick    =()=>delPlayer(name);
    return row;
  }
  function renderTodayRow(name){
    const d = ymd(datePick.value);
    const row = q('row-'+cssId(name));
    if(!row) return;
    const st = S.records[d]?.[name] || '';
    const dot = row.querySelector('.status-dot');
    dot.className = 'status-dot' + (st?(' dot-'+st):'');
    const badge = row.querySelector('.status-badge');
    badge.className = 'status-badge '+st;
    badge.textContent = st ? labelFor(st) : '‚Äî';
  }

  // ---------- Render: Monthly Report ----------
  function renderMonth(){
    // Determine month/year
    let ym = monthPick.value;
    if(!ym){
      ym = fmtMonthYYYYMM(today());
      monthPick.value = ym;
    }
    const [Y, M] = ym.split('-').map(n=>parseInt(n,10));
    const days = daysInMonth(Y, M); // 1..days

    // Head
    let h = '<tr><th>Player</th>';
    for(let d=1; d<=days; d++) h+=`<th>${d}</th>`;
    h += '<th class="bP">P</th><th class="bA">A</th><th class="bL">L</th><th>%</th></tr>';
    monthHead.innerHTML = h;

    // Body
    monthBody.innerHTML='';
    S.players.forEach(name=>{
      let row = document.createElement('tr');
      let cells = `<th>${escapeHtml(name)}</th>`;
      let cP=0,cA=0,cL=0;
      for(let d=1; d<=days; d++){
        const date = `${Y}-${String(M).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const st = S.records[date]?.[name] || '';
        if(st==='P') cP++; else if(st==='A') cA++; else if(st==='L') cL++;
        cells += `<td class="badge ${st?('b'+st):''}">${st||''}</td>`;
      }
      const total = cP + cA + cL;
      const pct = total ? Math.round(cP/total*100) : 0;
      cells += `<td class="bP">${cP}</td><td class="bA">${cA}</td><td class="bL">${cL}</td><td>${pct}%</td>`;
      row.innerHTML = cells;
      monthBody.appendChild(row);
    });

    // Footer: column totals
    let foot = document.createElement('tr');
    let footCells = `<td><strong>Totals</strong></td>`;
    let colP=Array(days).fill(0), colA=Array(days).fill(0), colL=Array(days).fill(0);
    for(let d=1; d<=days; d++){
      const date = `${Y}-${String(M).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      const dayRec = S.records[date] || {};
      Object.values(dayRec).forEach(st=>{
        if(st==='P') colP[d-1]++; else if(st==='A') colA[d-1]++; else if(st==='L') colL[d-1]++;
      });
      footCells += `<td><span class="bP">${colP[d-1]}</span>/<span class="bA">${colA[d-1]}</span>/<span class="bL">${colL[d-1]}</span></td>`;
    }
    // overall totals (month)
    const tP = colP.reduce((a,b)=>a+b,0), tA = colA.reduce((a,b)=>a+b,0), tL = colL.reduce((a,b)=>a+b,0);
    const tTotal = tP + tA + tL;
    const tPct = tTotal ? Math.round(tP / tTotal * 100) : 0;
    footCells += `<td class="bP">${tP}</td><td class="bA">${tA}</td><td class="bL">${tL}</td><td>${tPct}%</td>`;
    foot.innerHTML = footCells;
    monthFoot.innerHTML = '';
    monthFoot.appendChild(foot);

    // Update side summary for the selected month
    updateSummary();
  }

  // ---------- Summary (for selected month) ----------
  function updateSummary(){
    sumPlayers.textContent = S.players.length;
    sumDays.textContent = Object.keys(S.records).length;

    // month filter
    const ym = monthPick.value || fmtMonthYYYYMM(today());
    let P=0,A=0,L=0, total=0;
    Object.entries(S.records).forEach(([d, rec])=>{
      if(d.startsWith(ym)){
        Object.values(rec).forEach(st=>{
          if(st==='P') P++; else if(st==='A') A++; else if(st==='L') L++;
        });
      }
    });
    total = P + A + L;
    sumP.textContent = P;
    sumA.textContent = A;
    sumL.textContent = L;
    sumPct.textContent = (total? Math.round(P/total*100):0) + '%';
  }

  // ---------- Helpers ----------
  function labelFor(s){ return s==='P'?'Present':(s==='A'?'Absent':(s==='L'?'Late':'‚Äî')); }
  function cssId(s){ return s.replace(/\s+/g,'_').replace(/[^\w-]/g,''); }
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

  // ---------- Events ----------
  addBtn.onclick=()=>{ const v=playerName.value.trim(); if(!v) return; addPlayer(v); playerName.value=''; };
  playerName.addEventListener('keydown',e=>{ if(e.key==='Enter') addBtn.click(); });

  bulkBtn.onclick=()=>{ const t=bulk.value.trim(); if(!t) return; addBulk(t); bulk.value=''; };

  exportBtn.onclick=()=>{
  const ym = monthPick.value || fmtMonthYYYYMM(today());
  const [Y,M] = ym.split("-");
  const monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
  const fileName = `Attendance_${monthNames[parseInt(M)-1]}_${Y}.json`;

  const blob=new Blob([JSON.stringify(S,null,2)],{type:'application/json'});
  const a=document.createElement('a'); 
  a.href=URL.createObjectURL(blob); 
  a.download=fileName; 
  a.click();
};

  importBtn.onclick=()=>importFile.click();
  importFile.onchange=e=>{
    const f=e.target.files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=ev=>{
      try{
        const obj=JSON.parse(ev.target.result);
        if(!obj || !Array.isArray(obj.players) || typeof obj.records!=='object') throw new Error('Invalid file');
        S=obj; save(); renderToday(); renderMonth(); updateSummary();
      }catch(err){ alert('Import failed: '+ err.message); }
    };
    r.readAsText(f);
  };

  clearBtn.onclick=()=>{
    if(!confirm('Clear ALL data?')) return;
    S={players:[], records:{}}; save(); renderToday(); renderMonth(); updateSummary();
  };

  datePick.onchange=()=>renderToday();
  monthPick.onchange=()=>{ renderMonth(); updateSummary(); };
  refreshBtn.onclick=()=>{ renderMonth(); updateSummary(); };
  markAllP.onclick=()=>{ const d=ymd(datePick.value||today()); ensureDay(d); S.players.forEach(n=>S.records[d][n]='P'); save(); renderToday(); renderMonth(); updateSummary(); };
  markAllA.onclick=()=>{ const d=ymd(datePick.value||today()); ensureDay(d); S.players.forEach(n=>S.records[d][n]='A'); save(); renderToday(); renderMonth(); updateSummary(); };
  printBtn.onclick=()=>window.print();

  // ---------- Init ----------
  // default date controls
  datePick.value = today();
  monthPick.value = fmtMonthYYYYMM(today());
  renderToday(); renderMonth(); updateSummary();
})();
</script>
</body>
</html>
